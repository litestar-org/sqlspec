# Migration Guide: v0.35.0

## Overview

SQLSpec v0.35.0 introduces compiled driver layer support (mypyc) and adds the ADK memory store feature. Most users do not need to change application code, but custom adapter authors should verify one required override.

## Breaking Changes

### Protocol Cleanup

The following unused protocols were removed from `sqlspec.protocols`:

- `IterableParameters`
- `ExpressionWithAliasProtocol`
- `SelectBuilderProtocol`
- `StackResultProtocol`

If your code imported these directly, remove those imports. No runtime behavior changed.

### Custom Adapter Requirement

All custom adapters must override `_connection_in_transaction()` with direct attribute access.

```python
class MyDriver(SyncDriverAdapterBase):
    def _connection_in_transaction(self) -> bool:
        return self.connection.in_transaction
```

This requirement was previously documented; v0.35.0 enforces it to ensure mypyc compatibility.

## New Features

### Compiled Driver Layer (mypyc)

Driver base classes and mixins are now included in the mypyc build. This reduces dispatch overhead between compiled core modules and interpreted adapters.

No application changes are required. To build a compiled wheel:

```bash
HATCH_BUILD_HOOKS_ENABLE=1 uv build --extra mypyc
```

### ADK Memory Store

The ADK extension now includes memory stores and services for long-term recall:

- `SQLSpecMemoryService` (async)
- `SQLSpecSyncMemoryService` (sync)
- Memory stores for all ADK-supported adapters

Configuration is via `extension_config["adk"]`:

```python
extension_config={
    "adk": {
        "memory_table": "adk_memory_entries",
        "memory_use_fts": True,
        "memory_max_results": 50,
        "enable_memory": True,
        "include_memory_migration": True,
    }
}
```

## Migration Checklist

1. Remove imports of the deleted protocols (if any).
2. Ensure custom adapters implement `_connection_in_transaction()`.
3. (Optional) Enable ADK memory storage via `extension_config["adk"]`.
4. (Optional) Build compiled wheels with mypyc for driver-layer speedups.
